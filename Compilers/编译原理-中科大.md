## 4.3.2 二义性文法

给定文法G，如果存在句子s，它有两棵不同的分析树，那么称G是二义性文法。

从编译器角度， 二义性文法存在问题。

- 同一个程序会有不同的含义
- 程序运行的结果不是唯一的。

解决方法： 文法的重写

`表达式文法的重写`

![image-20230626204932294](images/image-20230626204932294.png)

  ![image-20230626212350722](images/image-20230626212350722.png)

## 语法分析

### 自顶向下分析

语法分析：给定文法G和句子s， 回答s是否能够从G推导出来？

基本算法思想：从G的开始符号出发，随意推导出某个句子t， 比较t和s

- 若t == s， 则回答是
- 若t！=s，则？

因为这是从开始符号出发推导出句子，因此称为自顶向下分析。

对应分析树自顶向下的构造顺序。	

```txt
tokens[];		// all tokens
i = 0;
stack = [S]		// S是开始符号
while(stack != [])
	if(stack[top] is a terminal t)
		if(t == token[i++])
			pop();
		else backtrack();
	else if (stack[top] is a nonterminal T)
		pop();
		push(the next right hand side of T)
```

https://www.bilibili.com/video/BV16h411X7JY?t=125.1&p=41

### 递归下降分析算法

![image-20230628212814128](images/image-20230628212814128.png)

- 算法基本思想
  - 每个非终结符构造一个分析函数。
  - 用*前看符号* 指导产生式规则的选择。

示例：

![image-20230628214134542](images/image-20230628214134542.png)

一般的算法框架

```
Parse_X()
	token = nextToken()
	switch(token)
	case ...: 
```

![image-20230629085440038](images/image-20230629085440038.png)

![image-20230629085405724](images/image-20230629085405724.png)

### LL(1)分析算法

语法分析器自动生成，利用分析工具。

![image-20230629092003567](images/image-20230629092003567.png)

LL(1) 分析算法

- 从左（L）向右读入程序，最左L推导，采用一个1 前向符号。
  - 分析高效 线性时间
  - 错误定位和诊断信息准确
  - 很多开源或者商业的生成工具
    - ANTLR

- 算法基本思想
  - 表驱动的分析算法

表驱动的LL分析器架构

![image-20230629093224663](images/image-20230629093224663.png)

## 抽象语法树

分析树：

- 分析树编码了句子的推导过程。
- 但是包含了很多不必要的信息
  - 注意，这些节点会占用额外的存储空间。
- 本质上上，这里的那些信息是重要的。
- 对于表达式而言，编译只需要知道运算符和运算数
  - 优先级、结合性等已经在语法分析部分处理掉了。
- 对于其他语句，函数等语言其他的构造而言也一样。
  - 例如编译器不关系赋值符号是=还是：=或者其他。

![image-20230630205042719](images/image-20230630205042719.png)

### 具体语法和抽象语法

- 具体语法是语法分析器使用的语法

- 必须适合语法分析，如各种分割符， 消除左递归、提取左公因子， 等等

- 抽象语法树是用来表达语法结构的内部表示

  - 现在编译器一般都是采用抽象语法作为前端（词法语法分析器）和后端（代码生成）的接口。


## 抽象语法树数据结构
- 在编译器中， 为了定义抽象语法树，需要使用实现语法来定义一组数据结构。
  - 和实现语法密切相关

- 早期的编译器有的不采用抽象语法树结构
 - 直接在语法制导翻译中生成代码
 - 现在的编译器一般采用抽象语法树作为语法分析器的输出。
 - - 更好地系统支持‘
 - 简单化编译器设计

## 抽象语法树的定义（c语言）

### 数据结构的定义 

![image-20230630212625840](images/image-20230630212625840.png)

构造函数的定义

![image-20230630212848073](images/image-20230630212848073.png)

 示例

![image-20230630213432562](images/image-20230630213432562.png)

优美打印

![image-20230630213744751](images/image-20230630213744751.png)

https://www.bilibili.com/video/BV16h411X7JY?t=552.2&p=73
