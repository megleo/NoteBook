# 11 动态内存分配

## 应用场景

数组的长度常常是在运行的时候确定的；

一般的方法声明一个较大的数组，不仅造成了内存的浪费而且没有彻底解决溢出的问题。

## malloc 和 calloc 和realloc

malloc和free共同维护着一个可用的**内存池**。

```c++
void *malloc(size_t size);
void* free(void *pointer);
```

1. malloc 分配的是连续的一块内存； 
2. 分配的内存可能比你需要的稍微多一些；由编译器决定
3. 如果内存池是空的， 那么malloc会向操作系统提出请求，要求得到更多的内存， 如果操作系统无法提供，那么malloc会返回NULL；

malloc和calloc主要区别是后者返回内存指针之前把它初始化成0；

realloc(void *ptr, size_t new_size): 是内存扩大或者缩小。

```c++
pi = malloc(25 * sizeof(int));	// 推荐这种写法， 代码可移植
```

## 常见的动态内存的错误

1. 对NULL指针进行解引用操作；
2. 对分配的内存进行操作时越界；
3. 释放并非动态分配的内存
4. 试图释放一块动态内存的一部分； 
5. 以及一块动态内存被释放后继续使用
6. 